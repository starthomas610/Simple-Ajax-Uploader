/**  Simple Ajax Uploader v1.7 Copyright 2012-2013 LPology, LLC  MIT license https://github.com/LPology/Simple-Ajax-Uploader */ 
(function(m,n,q){var c=m.ss||{};c.obj2string=function(a,b){var d=[],e;for(e in a)if(a.hasOwnProperty(e)){var f=b?b+"["+e+"]":e,g=a[e];d.push("object"===typeof g?c.obj2string(g,f):encodeURIComponent(f)+"="+encodeURIComponent(g))}return d.join("&")};c.extendObj=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])};c.contains=function(a,b){for(var d=a.length;d--;)if(a[d]==b)return!0;return!1};c.removeItem=function(a,b){for(var d=a.length;d--;)a[d]==b&&a.splice(d,1)};c.addEvent=function(a,b,
d){a.attachEvent?a.attachEvent("on"+b,d):a.addEventListener(b,d,!1)};c.newXHR=function(){if("undefined"!==typeof XMLHttpRequest)return new m.XMLHttpRequest;if(m.ActiveXObject)try{return new m.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return!1}};c.parseJSON=function(a){if(!a)return!1;a=c.trim(a);if(m.JSON&&m.JSON.parse)try{return m.JSON.parse(a)}catch(b){return!1}return a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?(new Function("return "+a))():!1};c.getBox=function(a){var b,d=0;b=0;if(a.getBoundingClientRect)a=a.getBoundingClientRect(),b=n.documentElement,d=a.top+(m.pageYOffset||b.scrollTop)-(b.clientTop||0),b=a.left+(m.pageXOffset||b.scrollLeft)-(b.clientLeft||0);else{do b+=a.offsetLeft,d+=a.offsetTop;while(a=a.offsetParent)}return{top:Math.round(d),left:Math.round(b)}};c.addStyles=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a.style[d]=b[d])};c.copyLayout=function(a,
b){var d=c.getBox(a);c.addStyles(b,{position:"absolute",left:d.left+"px",top:d.top+"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})};c.toElement=function(){var a=n.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();c.getUID=function(){var a=0;return function(){return a++}}();c.trim=function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,"")};c.getFilename=function(a){return a.replace(/.*(\/|\\)/,"")};c.getExt=function(a){return-1!==
a.indexOf(".")?a.replace(/.*[.]/,""):""};c.hasClass=function(a,b){return 0<=(" "+a.className+" ").replace(/[\t\r\n]/g," ").indexOf(" "+b+" ")};c.addClass=function(a,b){if(!b||""===b)return!1;c.hasClass(a,b)||(a.className+=" "+b)};c.removeClass=function(a,b){a.className=a.className.replace(RegExp("(?:^|\\s)"+b+"(?!\\S)"),"")};c.purge=function(a){var b=a.attributes,d,e;if(b)for(d=b.length-1;0<=d;d-=1)e=b[d].name,"function"===typeof a[e]&&(a[e]=null);if(b=a.childNodes)for(b=b.length,d=0;d<b;d+=1)c.purge(a.childNodes[d])};
c.remove=function(a){c.purge(a);a.parentNode&&a.parentNode.removeChild(a)};c.verifyElem=function(a){"undefined"!==typeof jQuery&&a instanceof jQuery?a=a[0]:"string"===typeof a&&("#"==a.charAt(0)&&(a=a.substr(1)),a=n.getElementById(a));if(!a||1!==a.nodeType)return!1;"A"==a.nodeName.toUpperCase()&&c.addEvent(a,"click",function(a){a&&a.preventDefault?a.preventDefault():m.event&&(m.event.returnValue=!1)});return a};c.SimpleUpload=function(a){this._opts={button:"",url:"",progressUrl:!1,multiple:!1,maxUploads:3,
queue:!0,checkProgressInterval:50,keyParamName:"APC_UPLOAD_PROGRESS",allowedExtensions:[],accept:"",maxSize:!1,name:"",data:{},autoSubmit:!0,multipart:!1,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",onChange:function(a,d){},onSubmit:function(a,d){},onProgress:function(a){},onUpdateFileSize:function(a){},onComplete:function(a,d){},onExtError:function(a,d){},onSizeError:function(a,d){},onError:function(a,d,c){},startXHR:function(a,d){},endXHR:function(a,d){},startNonXHR:function(a){},
endNonXHR:function(a){}};c.extendObj(this._opts,a);this._button=c.verifyElem(this._opts.button);if(!1===this._button)throw Error("Invalid button. Make sure the element you're passing exists.");!1===this._opts.multiple&&(this._opts.maxUploads=1);this._overButton=!1;this._queue=[];this._active=0;this._doProg=this._disabled=!1;this._progKeys=[];this._maxFails=10;this._isXhrOk()?this._XhrOk=!0:(this._XhrOk=!1,this._opts.progressUrl&&this._getKey());this._isSafari=0<Object.prototype.toString.call(m.HTMLElement).indexOf("Constructor");
this._createInput();this.enable();this.rerouteClicks(this._button)};c.SimpleUpload.prototype={log:function(a){this._opts.debug&&m.console&&console.log("[uploader] "+a)},setData:function(a){this._opts.data=a},setProgressBar:function(a){this._progBar=c.verifyElem(a)},setFileSizeBox:function(a){this._sizeBox=c.verifyElem(a)},setProgressContainer:function(a){this._progBox=c.verifyElem(a)},getQueueSize:function(){return this._queue.length},_cycleQueue:function(){this._disabled&&this.enable();0<this._queue.length&&
this._opts.autoSubmit&&this.submit()},removeCurrent:function(){c.removeItem(this._queue,this._file);this._file=null;this._cycleQueue()},disable:function(){var a=this._button.nodeName.toUpperCase();c.addClass(this._button,this._opts.disabledClass);this._disabled=!0;if("INPUT"==a||"BUTTON"==a)this._button.disabled=!0;this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){c.removeClass(this._button,this._opts.disabledClass);this._disabled=this._button.disabled=
!1},_isXhrOk:function(){var a=n.createElement("input");a.type="file";return"multiple"in a&&"undefined"!=typeof File&&"undefined"!=typeof(new XMLHttpRequest).upload},_createInput:function(){var a=this,b=n.createElement("div");this._input=n.createElement("input");this._input.type="file";this._input.name=this._opts.name;this._XhrOk&&!this._isSafari&&(this._input.multiple=!0);"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept);c.addStyles(b,{display:"block",position:"absolute",
overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});c.addStyles(this._input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});"0"!==b.style.opacity&&(b.style.filter="alpha(opacity=0)");c.addEvent(this._input,"change",function(){var b,e;if(a._input&&""!==a._input.value){if(a._XhrOk){b=c.getFilename(a._input.files[0].name);e=c.getExt(b);if(!1===a._opts.onChange.call(a,b,e))return;b=a._input.files.length;a._opts.multiple||
(b=1);for(e=0;e<b;e++)a._queue.push(a._input.files[e])}else{b=c.getFilename(a._input.value);e=c.getExt(b);if(!1===a._opts.onChange.call(a,b,e))return;a._queue.push(a._input)}c.removeClass(a._button,a._opts.hoverClass);c.removeClass(a._button,a._opts.focusClass);c.remove(a._input.parentNode);a._input=null;a._createInput();a._opts.autoSubmit&&a.submit()}});c.addEvent(this._input,"mouseover",function(){!0===a._overButton&&c.addClass(a._button,a._opts.hoverClass)});c.addEvent(this._input,"mouseout",function(){!0===
a._overButton&&(c.removeClass(a._button,a._opts.hoverClass),c.removeClass(a._button,a._opts.focusClass),a._input.parentNode.style.visibility="hidden")});c.addEvent(this._input,"focus",function(){!0===a._overButton&&c.addClass(a._button,a._opts.focusClass)});c.addEvent(this._input,"blur",function(){!0===a._overButton&&c.removeClass(a._button,a._opts.focusClass)});n.body.appendChild(b);b.appendChild(this._input)},rerouteClicks:function(a){var b=this;a=c.verifyElem(a);c.addEvent(a,"mouseover",function(){b._disabled||
(b._input||b._createInput(),b._overButton=a==b._button?!0:!1,c.copyLayout(a,b._input.parentNode),b._input.parentNode.style.visibility="visible")})},_getFrame:function(){var a=c.getUID(),b=c.toElement('<iframe src="javascript:false;" name="'+a+'" />');n.body.appendChild(b);b.style.display="none";b.id=a;return b},_getForm:function(a){var b=c.toElement('<form method="post" enctype="multipart/form-data"></form>');n.body.appendChild(b);b.style.display="none";b.action=this._opts.url;b.target=a.name;return b},
_getHidden:function(a,b){var c=n.createElement("input");c.type="hidden";c.name=a;c.value=b;return c},_errorFinish:function(a,b,d,e,f,g){this._active--;this.log("Error. Server response :"+d);f&&(f.innerHTML="");g&&c.remove(g);this._opts.onError.call(this,b,a,d);this._cycleQueue()},_finish:function(a,b,d,e,f){var g=a;if("json"==this._opts.responseType.toLowerCase()&&(a=c.parseJSON(a),!1===a)){this._errorFinish("parseerror",b,g,d,e,f);return}this._active--;this.log("server response: "+g);e&&(e.innerHTML=
"");f&&c.remove(f);this._opts.onComplete.call(this,b,a);this._cycleQueue()},_uploadXhr:function(a,b,d,e,f){var g=this,h=this._opts,l=c.newXHR(),k={};if(!1===h.startXHR.call(this,a,b))this._disabled&&this.enable(),this._active--;else{d&&(d.innerHTML=b+"K");k[h.name]=a;c.extendObj(k,h.data);k=h.url+"?"+c.obj2string(k);h.onProgress.call(this,0);e&&(e.style.width="0%");c.addEvent(l.upload,"progress",function(a){a.lengthComputable&&(a=Math.round(100*(a.loaded/a.total)),h.onProgress.call(g,a),e&&(e.style.width=
a+"%"))});c.addEvent(l.upload,"error",function(){g._errorFinish("transfererror",a,"None",e,d,f)});l.onreadystatechange=function(){4===this.readyState&&(200===this.status||201===this.status?(h.endXHR.call(g,a,b),g._finish(this.responseText,a,e,d,f)):g._errorFinish("servererror",a,this.responseText,e,d,f))};l.open(h.method.toUpperCase(),k,!0);l.setRequestHeader("X-Requested-With","XMLHttpRequest");l.setRequestHeader("X-File-Name",encodeURIComponent(a));"json"==h.responseType.toLowerCase()&&l.setRequestHeader("Accept",
"application/json, text/javascript, */*; q=0.01");if(!0===h.multipart){var k=new FormData,m;for(m in h.data)h.data.hasOwnProperty(m)&&k.append(m,h.data[m]);k.append(h.name,this._file);this.log("uploading - using multipart form");l.send(k)}else l.setRequestHeader("Content-Type","application/octet-stream"),this.log("uploading - using binary stream"),l.send(this._file);this.removeCurrent()}},_uploadIframe:function(a,b,d,e){var f=this,g=this._opts,h=this._progKey,l=this._getFrame(),k=this._getForm(l);
if(!1===g.startNonXHR.call(this,a))this._disabled&&this.enable(),this._active--;else{if(this._doProg){var n=this._getHidden(g.keyParamName,h);k.appendChild(n)}for(var p in g.data)g.data.hasOwnProperty(p)&&(n=this._getHidden(p,g.data[p]),k.appendChild(n));k.appendChild(this._file);g.onProgress.call(this,0);d&&(d.style.width="0%");c.addEvent(l,"load",function(){var k=(l.contentDocument?l.contentDocument:l.contentWindow.document).body.innerHTML;c.removeItem(f._progKeys,h);c.remove(l);h=l=null;g.endNonXHR.call(f,
a);f._finish(k,a,d,b,e)});f.log("commencing upload using iframe");k.submit();c.remove(k);k=null;f._doProg&&(this._progKeys.push(h),m.setTimeout(function(){f.log("requesting first progress update");f._getProg(h,d,b,1)},f._opts.checkProgressInterval),this._progKey+=c.getUID(),57<=this._progKey.length&&(this._progKey=c.getUID()+this._progKey.substring(0,15)));this.removeCurrent()}},_getProg:function(a,b,d,e){if(a){var f=this,g=this._opts,h=c.newXHR(),l=(new Date).getTime(),l=g.progressUrl+"?progresskey="+
encodeURIComponent(a)+"&_="+l;h.onreadystatechange=function(){var k,h=g.checkProgressInterval;if(4===this.readyState)if(200===this.status){if((k=c.parseJSON(this.responseText))&&!0===k.success){e++;g.onUpdateFileSize.call(f,k.size);g.onProgress.call(f,k.pct);b&&(b.style.width=k.pct+"%");d&&k.size&&(d.innerHTML=k.size+"K");if(100>k.pct&&c.contains(f._progKeys,a)){if(0===k.pct&&0===k.size&&e>=f._maxFails){f.log("reached limit of failed progress requests");return}m.setTimeout(function(){f._getProg(a,
b,d,e);e=a=null},h)}h=null}}else a=null,f._doProg=!1,f._progKey=null,c.removeItem(f._progKeys,a),f.log("Progress error. Status: "+this.status+" Response: "+this.responseText);k=null};h.open("GET",l,!0);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");h.send();h=null}},_getKey:function(){var a=this,b=c.newXHR(),d=(new Date).getTime(),d=a._opts.progressUrl+"?getkey="+d;a._progKey=null;b.onreadystatechange=function(){var b;
4===this.readyState&&(200===this.status?(b=c.parseJSON(this.responseText))&&b.key&&(a._progKey=b.key,a.log("upload progress key received. Key: "+b.key)):a.log("Progress key error. Status: "+this.status+" Response: "+this.responseText))};b.open("GET",d,!0);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");b.send();b=null},_checkFile:function(a,b,c){var e=this._opts.allowedExtensions,f=e.length,g=!1;if(0<f){for(b=b.toLowerCase();f--;)if(e[f].toLowerCase()==
b){g=!0;break}if(!g)return this.removeCurrent(),this.log("file extension not permitted"),this._opts.onExtError.call(this,a,b),!1}return c&&!1!==this._opts.maxSize&&c>this._opts.maxSize?(this.removeCurrent(),this.log(a+" exceeds "+this._opts.maxSize+"K limit"),this._opts.onSizeError.call(this,a,c),!1):!0},submit:function(){var a,b,d;this._disabled||this._active>=this._opts.maxUploads||1>this._queue.length||(this._file=this._queue[0],this._XhrOk?(a=c.getFilename(this._file.name),d=Math.round(this._file.size/
1024)):a=c.getFilename(this._file.value),b=c.getExt(a),this._checkFile(a,b,d)&&!1!==this._opts.onSubmit.call(this,a,b)&&((!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable(),this._active++,this._XhrOk?this._uploadXhr(a,d,this._sizeBox,this._progBar,this._progBox):(!1!==this._opts.progressUrl&&this._progKey?this._doProg=!0:(this._doProg=!1,this.log("no upload progress - progressUrl not defined or progress key not available")),this._uploadIframe(a,this._sizeBox,
this._progBar,this._progBox)),this._progBox=this._progBar=this._sizeBox=null))}};m.ss=c})(window,document);