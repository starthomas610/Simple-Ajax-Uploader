/** Simple Ajax Uploader v1.4.2 Copyright 2012-2013 LPology, LLC  MIT license https://github.com/LPology/Simple-Ajax-Uploader */ 
var ss=ss||{};ss.obj2string=function(a,b){var c=[],d;if("object"!==typeof a)return"";for(d in a)if(a.hasOwnProperty(d)){var e=b?b+"["+d+"]":d,f=a[d];c.push("object"===typeof f?ss.obj2string(f,e):encodeURIComponent(e)+"="+encodeURIComponent(f))}return c.join("&")};ss.extendObj=function(a,b){var c;if("object"!==typeof a||"object"!==typeof b)return!1;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};
ss.addEvent=function(a,b,c){"string"===typeof a&&(a=document.getElementById(a));a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)};ss.newXHR=function(){if(void 0!==typeof XMLHttpRequest)return new window.XMLHttpRequest;if(window.ActiveXObject)try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return!1}};
ss.parseJSON=function(a){if(!a||"string"!==typeof a)return!1;a=ss.trim(a);return window.JSON&&window.JSON.parse?window.JSON.parse(a):a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?(new Function("return "+a))():!1};ss.getOffsetSum=function(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop,10),c+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{top:b,left:c}};
ss.getOffsetRect=function(a){a=a.getBoundingClientRect();var b=document.body,c=document.documentElement,d=a.left+(window.pageXOffset||c.scrollLeft||b.scrollLeft)-(c.clientLeft||b.clientLeft||0);return{top:Math.round(a.top+(window.pageYOffset||c.scrollTop||b.scrollTop)-(c.clientTop||b.clientTop||0)),left:Math.round(d)}};ss.getOffset=function(a){return a.getBoundingClientRect?ss.getOffsetRect(a):ss.getOffsetSum(a)};
ss.getBox=function(a){var b,c;c=ss.getOffset(a);b=c.left;c=c.top;return{left:b,right:b+a.offsetWidth,top:c,bottom:c+a.offsetHeight}};ss.addStyles=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])};ss.copyLayout=function(a,b){var c=ss.getBox(a);ss.addStyles(b,{position:"absolute",left:c.left+"px",top:c.top+"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})};
ss.toElement=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();ss.getUID=function(){var a=0;return function(){return a++}}();ss.trim=function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,"")};ss.getExt=function(a){return-1!==a.indexOf(".")?a.replace(/.*[.]/,""):""};ss.hasClass=function(a,b){return RegExp("(^| )"+b+"( |$)").test(a.className)};
ss.addClass=function(a,b){if(!b||""===b)return!1;ss.hasClass(a,b)||(a.className+=" "+b)};ss.removeClass=function(a,b){a.className=a.className.replace(RegExp("(^| )"+b+"( |$)")," ").replace(/^\s+|\s+$/g,"")};ss.remove=function(a){a.parentNode&&a.parentNode.removeChild(a)};
ss.verifyElem=function(a){a.jquery?a=a[0]:"string"===typeof a&&(/^#.*/.test(a)&&(a=a.slice(1)),a=document.getElementById(a));if(!a||1!==a.nodeType)return!1;"A"==a.nodeName.toUpperCase()&&ss.addEvent(a,"click",function(a){a&&a.preventDefault?a.preventDefault():window.event&&(window.event.returnValue=!1)});return a};
ss.SimpleUpload=function(a){this._settings={button:"",url:"",progressUrl:!1,checkProgressInterval:50,keyParamName:"APC_UPLOAD_PROGRESS",name:"",data:{},autoSubmit:!0,multipart:!1,responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",onChange:function(){},onSubmit:function(){},onProgress:function(){},onUpdateFileSize:function(){},onComplete:function(){},onError:function(){},startXHR:function(){},endXHR:function(){},startNonXHR:function(){},endNonXHR:function(){}};ss.extendObj(this._settings,
a);this._button=ss.verifyElem(this._settings.button);if(!1===this._button)throw Error("Invalid button. Make sure the element you're passing exists.");this._filename=this._input=null;this._doProgressUpdates=this._disabled=!1;this._uploadProgressKey=this._timer=null;this._uploadIsActive=!1;this._XhrIsSupported=this._isXhrUploadSupported()?!0:!1;this.enable();this._rerouteClicks()};
ss.SimpleUpload.prototype={log:function(a){this._settings.debug&&window.console&&console.log("[uploader] "+a)},setData:function(a){this._settings.data="object"===typeof a?a:{}},disable:function(){var a=this._button.nodeName.toUpperCase();ss.addClass(this._button,this._settings.disabledClass);this._disabled=!0;("INPUT"==a||"BUTTON"==a)&&this._button.setAttribute("disabled","disabled");this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){ss.removeClass(this._button,
this._settings.disabledClass);this._button.removeAttribute("disabled");this._disabled=!1;!1===this._XhrIsSupported&&this._settings.progressUrl&&this._getUploadProgressKey()},_isXhrUploadSupported:function(){var a=document.createElement("input");a.type="file";return"multiple"in a&&"undefined"!=typeof File&&"undefined"!=typeof(new XMLHttpRequest).upload},_createInput:function(){var a=this,b=document.createElement("input"),c=document.createElement("div"),d;b.setAttribute("type","file");b.setAttribute("name",
a._settings.name);ss.addStyles(b,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});ss.addStyles(c,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});if("0"!==c.style.opacity){if("undefined"==typeof c.filters)throw Error("Opacity not supported by the browser");c.style.filter="alpha(opacity=0)"}ss.addEvent(b,"change",function(){b&&""!==b.value&&(d=b.value.replace(/.*(\/|\\)/,
""),a._filename=d,!1!==a._settings.onChange.call(a,d,ss.getExt(d))&&a._settings.autoSubmit&&a.submit())});ss.addEvent(b,"mouseover",function(){ss.addClass(a._button,a._settings.hoverClass)});ss.addEvent(b,"mouseout",function(){ss.removeClass(a._button,a._settings.hoverClass);ss.removeClass(a._button,a._settings.focusClass);b.parentNode&&(b.parentNode.style.visibility="hidden")});ss.addEvent(b,"focus",function(){ss.addClass(a._button,a._settings.focusClass)});ss.addEvent(b,"blur",function(){ss.removeClass(a._button,
a._settings.focusClass)});c.appendChild(b);document.body.appendChild(c);a._input=b},_clearInput:function(){this._input&&(ss.remove(this._input.parentNode),ss.removeClass(this._button,this._settings.hoverClass),ss.removeClass(this._button,this._settings.focusClass),delete this._input,this._createInput())},_rerouteClicks:function(){var a=this,b;ss.addEvent(a._button,"mouseover",function(){a._disabled||(a._input||a._createInput(),b=a._input.parentNode,ss.copyLayout(a._button,b),b.style.visibility="visible")})},
_createIframe:function(){var a=ss.getUID(),b=ss.toElement('<iframe src="javascript:false;" name="'+a+'" />');b.setAttribute("id",a);b.style.display="none";document.body.appendChild(b);return b},_createForm:function(a){var b=this._settings,c=ss.toElement('<form method="post" enctype="multipart/form-data"></form>');c.setAttribute("action",b.url);c.setAttribute("target",a.name);c.style.display="none";document.body.appendChild(c);return c},_createHiddenInput:function(a,b){var c=document.createElement("input");
c.type="hidden";c.name=a;c.value=b;return c},_handleXHRresponse:function(a,b){var c=this._settings,d=ss.trim(a.responseText);this.log("server response received");this.log("responseText = "+d);"json"==c.responseType.toLowerCase()&&(d=ss.parseJSON(d));!1===d?c.onError.call(this,b,"parse error",a.responseText):c.onComplete.call(this,b,d);this.enable();this._clearInput()},_uploadXhr:function(){var a=this,b=a._settings,c=a._filename,d=Math.round(a._input.files[0].size/1024),e={},f=ss.newXHR(),g;!1===b.startXHR.call(a,
c,d)?a.enable():(b.onProgress.call(a,0),e[b.name]=c,ss.extendObj(e,b.data),e=ss.obj2string(e),e=b.url+"?"+e,ss.addEvent(f.upload,"progress",function(c){c.lengthComputable&&(g=Math.round(100*(c.loaded/c.total)),b.onProgress.call(a,g))}),ss.addEvent(f.upload,"error",function(){a.log("transfer error during upload");b.endXHR.call(a,c,d);b.onError.call(a,c,"transfer error","none")}),f.onreadystatechange=function(){4===f.readyState&&(200===f.status?(b.endXHR.call(a,c,d),a._handleXHRresponse(f,c)):(a.log("Progress key error. Status: "+
f.status+" Response: "+f.responseText),b.onError.call(a,c,"server error",f.responseText)))},f.open("POST",e,!0),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.setRequestHeader("X-File-Name",encodeURIComponent(c)),"json"==b.responseType.toLowerCase()&&f.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),!0===b.multipart?(e=new FormData,e.append(b.name,a._input.files[0]),a.log("commencing upload - multipart form"),f.send(e)):(f.setRequestHeader("Content-Type","application/octet-stream"),
a.log("commencing upload - binary stream"),f.send(a._input.files[0])))},_handleIframeResponse:function(a){var b=this._settings,c=this._filename,d,e;a.parentNode&&(d=a.contentWindow?a.contentWindow.document:a.contentDocument&&a.contentDocument.document?a.contentDocument.document:a.contentDocument,d.body&&!1===d.body.innerHTML||(d=d.body.innerHTML,e=d.toString(),this.log("response = "+e),"json"==b.responseType.toLowerCase()&&(d=ss.parseJSON(e)),!1===d?b.onError.call(this,c,"parse error",e):b.onComplete.call(this,
c,d),ss.remove(a),this.enable(),this._clearInput()))},_uploadIframe:function(){var a=this,b=a._settings,c,d=a._filename,e=a._createIframe(),f=a._createForm(e),g;a._doProgressUpdates&&(c=a._createHiddenInput(b.keyParamName,a._uploadProgressKey),f.appendChild(c));if(!1===b.startNonXHR.call(a,d))a.enable();else{b.onProgress.call(a,0);c=b.data;for(g in c)if(c.hasOwnProperty(g)){var h=a._createHiddenInput(g,c[g]);f.appendChild(h)}f.appendChild(a._input);a.log("commencing upload");a._uploadIsActive=!0;
ss.addEvent(e,"load",function(){a._uploadIsActive=!1;a._doProgressUpdates&&window.clearTimeout(a._timer);b.endNonXHR.call(a,d);ss.remove(f);a._handleIframeResponse(e,d)});f.submit();a._doProgressUpdates&&(a.log("Requesting first progress update"),a._getUploadProgress())}},_startProgressTimer:function(){var a=this;a._timer=window.setTimeout(function(){a._getUploadProgress()},a._settings.checkProgressInterval)},_getUploadProgress:function(){var a=this,b=a._uploadProgressKey,c=ss.newXHR(),d=(new Date).getTime(),
b=a._settings.progressUrl+"?progresskey="+encodeURIComponent(b)+"&_="+d,e;c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){if((e=ss.parseJSON(c.responseText))&&!0===e.success)a._settings.onUpdateFileSize.call(a,e.size),a._settings.onProgress.call(a,e.pct),100>e.pct&&!0===a._uploadIsActive&&a._startProgressTimer()}else a.log("Progress error. Status: "+c.status+" Response: "+c.responseText)};c.open("GET",b,!0);c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.setRequestHeader("Accept",
"application/json, text/javascript, */*; q=0.01");c.setRequestHeader("Cache-Control","no-cache");c.send()},_getUploadProgressKey:function(){var a=this,b=ss.newXHR(),c=(new Date).getTime(),c=a._settings.progressUrl+"?getkey="+c,d;a._uploadProgressKey=null;b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){if((d=ss.parseJSON(b.responseText))&&d.key)a._uploadProgressKey=d.key,a.log("Upload progress key received. Key: "+d.key)}else a.log("Error retrieving progress key. Server response: "+
b.responseText)};b.open("GET",c,!0);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");b.setRequestHeader("Cache-Control","no-cache");b.send()},submit:function(){var a=this._settings;!this._disabled&&(this._input&&""!==this._input.value)&&!1!==a.onSubmit.call(this,this._filename,ss.getExt(this._filename))&&(this.disable(),this._XhrIsSupported?(this.log("XHR upload supported"),this._uploadXhr()):(this.log("XHR upload not supported, using iFrame method"),
!1!==a.progressUrl&&null!==this._uploadProgressKey?this._doProgressUpdates=!0:this.log("progressUrl not defined or progress key not available - no upload progress"),this._uploadIframe()))}};