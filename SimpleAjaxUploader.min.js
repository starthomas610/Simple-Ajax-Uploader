/**  Simple Ajax Uploader v1.8.1 Copyright 2012-2013 LPology, LLC  MIT license https://github.com/LPology/Simple-Ajax-Uploader */ 
(function(n,q,w){var c=n.ss||{},x=/^\s+/,y=/\s+$/,z=/[xy]/g,A=/.*(\/|\\)/,B=/.*[.]/,C=/[\t\r\n]/g,D=0<Object.prototype.toString.call(n.HTMLElement).indexOf("Constructor"),v=q.createElement("input"),u;v.type="file";u="multiple"in v&&"undefined"!==typeof File&&"undefined"!==typeof(new XMLHttpRequest).upload;c.obj2string=function(a,b){var d=[],g;for(g in a)if(a.hasOwnProperty(g)){var l=b?b+"["+g+"]":g,e=a[g];d.push("object"===typeof e?c.obj2string(e,l):encodeURIComponent(l)+"="+encodeURIComponent(e))}return d.join("&")};
c.extendObj=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])};c.contains=function(a,b){for(var d=a.length;d--;)if(a[d]===b)return!0;return!1};c.removeItem=function(a,b){for(var d=a.length;d--;)if(a[d]===b){a.splice(d,1);break}};c.addEvent=function(a,b,d){a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent("on"+b,d);return function(){c.removeEvent(a,b,d)}};c.removeEvent=function(a,b,d){a.removeEventListener?a.removeEventListener(b,d,!1):a.detachEvent("on"+b,d)};c.newXHR=function(){if("undefined"!==
typeof XMLHttpRequest)return new n.XMLHttpRequest;if(n.ActiveXObject)try{return new n.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return!1}};c.parseJSON=function(a){if(!a)return!1;a=c.trim(a);if(n.JSON&&n.JSON.parse)try{return n.JSON.parse(a)}catch(b){return!1}return a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?(new Function("return "+a))():!1};c.getBox=
function(a){var b,d=0;b=0;if(a.getBoundingClientRect)a=a.getBoundingClientRect(),b=q.documentElement,d=a.top+(n.pageYOffset||b.scrollTop)-(b.clientTop||0),b=a.left+(n.pageXOffset||b.scrollLeft)-(b.clientLeft||0);else{do b+=a.offsetLeft,d+=a.offsetTop;while(a=a.offsetParent)}return{top:Math.round(d),left:Math.round(b)}};c.addStyles=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a.style[d]=b[d])};c.copyLayout=function(a,b){var d=c.getBox(a);c.addStyles(b,{position:"absolute",left:d.left+"px",top:d.top+
"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})};c.toElement=function(){var a=q.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();c.getUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(z,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};c.trim=function(a){return a.toString().replace(x,"").replace(y,"")};c.getFilename=function(a){return a.replace(A,"")};c.getExt=function(a){return-1!==a.indexOf(".")?
a.replace(B,""):""};c.hasClass=function(a,b){return 0<=(" "+a.className+" ").replace(C," ").indexOf(" "+b+" ")};c.addClass=function(a,b){if(!b||""===b)return!1;c.hasClass(a,b)||(a.className+=" "+b)};c.removeClass=function(){var a={};return function(b,d){a[d]||(a[d]=RegExp("(?:^|\\s)"+d+"(?!\\S)"));b.className=b.className.replace(a[d],"")}}();c.purge=function(a){var b=a.attributes,d,g;if(b)for(d=b.length-1;0<=d;d-=1)g=b[d].name,"function"===typeof a[g]&&(a[g]=null);if(b=a.childNodes)for(b=b.length,
d=0;d<b;d+=1)c.purge(a.childNodes[d])};c.remove=function(a){a.parentNode&&(c.purge(a),a.parentNode.removeChild(a))};c.verifyElem=function(a){"undefined"!==typeof jQuery&&a instanceof jQuery?a=a[0]:"string"===typeof a&&("#"==a.charAt(0)&&(a=a.substr(1)),a=q.getElementById(a));if(!a||1!==a.nodeType)return!1;"A"==a.nodeName.toUpperCase()&&(a.style.cursor="pointer",c.addEvent(a,"click",function(a){a&&a.preventDefault?a.preventDefault():n.event&&(n.event.returnValue=!1)}));return a};c.SimpleUpload=function(a){var b,
d;this._opts={button:"",url:"",progressUrl:!1,nginxProgressUrl:!1,multiple:!1,maxUploads:3,queue:!0,checkProgressInterval:50,keyParamName:"APC_UPLOAD_PROGRESS",nginxProgressHeader:"X-Progress-ID",allowedExtensions:[],accept:"",maxSize:!1,name:"",data:{},autoSubmit:!0,multipart:!1,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",onAbort:function(a){},onChange:function(a,b){},onSubmit:function(a,b){},onProgress:function(a){},onUpdateFileSize:function(a){},onComplete:function(a,
b){},onExtError:function(a,b){},onSizeError:function(a,b){},onError:function(a,b,d,c){},startXHR:function(a,b){},endXHR:function(a,b){},startNonXHR:function(a){},endNonXHR:function(a){}};c.extendObj(this._opts,a);a=null;this._btns=[];if(this._opts.button instanceof Array)for(b=this._opts.button.length,a=0;a<b;a++)d=c.verifyElem(this._opts.button[a]),!1!==d?this._btns.push(this.rerouteClicks(d)):this.log("Button with array index "+a+" is invalid");else d=c.verifyElem(this._opts.button),!1!==d&&this._btns.push(this.rerouteClicks(d));
delete this._opts.button;if(1>this._btns.length||!1===this._btns[0])throw Error("Invalid button. Make sure the element you're passing exists.");!1===this._opts.multiple&&(this._opts.maxUploads=1);this._queue=[];this._active=0;this._disabled=!1;this._progKeys=[];this._maxFails=10;u||!this._opts.progressUrl&&!this._opts.nginxProgressUrl||(this._sizeFlags={},this._progKey=c.getUID());this._createInput();this.enable()};c.SimpleUpload.prototype={destroy:function(){for(var a=this._btns.length;a--;)this._btns[a].off&&
this._btns[a].off(),c.removeClass(this._btns[a],this._opts.hoverClass),c.removeClass(this._btns[a],this._opts.focusClass),c.removeClass(this._btns[a],this._opts.disabledClass),this._btns[a].disabled=!1;c.remove(this._input.parentNode);for(var b in this)this.hasOwnProperty(b)&&delete this.prop},log:function(a){this._opts.debug&&n.console&&console.log("[uploader] "+a)},setData:function(a){this._opts.data=a},setProgressBar:function(a){this._progBar=c.verifyElem(a)},setPctBox:function(a){this._pctBox=
c.verifyElem(a)},setFileSizeBox:function(a){this._sizeBox=c.verifyElem(a)},setProgressContainer:function(a){this._progBox=c.verifyElem(a)},setAbortBtn:function(a,b){this._abortBtn=c.verifyElem(a);this._removeAbort=!1;b&&(this._removeAbort=!0)},getQueueSize:function(){return this._queue.length},_cycleQueue:function(){0<this._queue.length&&this._opts.autoSubmit&&this.submit()},removeCurrent:function(){c.removeItem(this._queue,this._file);delete this._file;this._file=null;this._cycleQueue()},disable:function(){var a=
this._btns.length,b;for(this._disabled=!0;a--;)if(b=this._btns[a].nodeName.toUpperCase(),c.addClass(this._btns[a],this._opts.disabledClass),"INPUT"==b||"BUTTON"==b)this._btns[a].disabled=!0;this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){var a=this._btns.length;for(this._disabled=!1;a--;)c.removeClass(this._btns[a],this._opts.disabledClass),this._btns[a].disabled=!1},_createInput:function(){var a=this,b=q.createElement("div");this._input=
q.createElement("input");this._input.type="file";this._input.name=this._opts.name;u&&!D&&(this._input.multiple=!0);"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept);c.addStyles(b,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});c.addStyles(this._input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});"0"!==b.style.opacity&&(b.style.filter=
"alpha( opacity=0 )");c.addEvent(this._input,"change",function(){var b,g;if(a._input&&""!==a._input.value){if(u){b=c.getFilename(a._input.files[0].name);g=c.getExt(b);if(!1===a._opts.onChange.call(a,b,g))return;b=a._input.files.length;a._opts.multiple||(b=1);for(g=0;g<b;g++)a._queue.push(a._input.files[g])}else{b=c.getFilename(a._input.value);g=c.getExt(b);if(!1===a._opts.onChange.call(a,b,g))return;a._queue.push(a._input)}c.removeClass(a._overBtn,a._opts.hoverClass);c.removeClass(a._overBtn,a._opts.focusClass);
c.remove(a._input.parentNode);delete a._input;a._createInput();a._opts.autoSubmit&&a.submit()}});c.addEvent(this._input,"mouseover",function(){c.addClass(a._overBtn,a._opts.hoverClass)});c.addEvent(this._input,"mouseout",function(){c.removeClass(a._overBtn,a._opts.hoverClass);c.removeClass(a._overBtn,a._opts.focusClass);a._input.parentNode.style.visibility="hidden"});c.addEvent(this._input,"focus",function(){c.addClass(a._overBtn,a._opts.focusClass)});c.addEvent(this._input,"blur",function(){c.removeClass(a._overBtn,
a._opts.focusClass)});q.body.appendChild(b);b.appendChild(this._input)},rerouteClicks:function(a){var b=this;a.off=c.addEvent(a,"mouseover",function(){b._disabled||(b._input||b._createInput(),b._overBtn=a,c.copyLayout(a,b._input.parentNode),b._input.parentNode.style.visibility="visible")});return a},_getFrame:function(){var a=c.getUID(),b=c.toElement('<iframe src="javascript:false;" name="'+a+'" />');q.body.appendChild(b);b.style.display="none";b.id=a;return b},_getForm:function(a){var b=c.toElement('<form method="post" enctype="multipart/form-data"></form>');
q.body.appendChild(b);b.style.display="none";b.action=this._opts.url;b.target=a.name;return b},_getHidden:function(a,b){var d=q.createElement("input");d.type="hidden";d.name=a;d.value=b;return d},_last:function(a,b,d,g,l){a&&(a.innerHTML="");b&&c.remove(b);d&&(d.innerHTML="");g&&l&&c.remove(g);this._active--;this._disabled&&this.enable();this._cycleQueue()},_errorFinish:function(a,b,d,c,l,e,k,h,f){this.log("Upload failed: "+a+" "+b);this._opts.onError.call(this,c,d,a,b);this._last(l,e,k,h,f)},_finish:function(a,
b,d,g,l,e,k,h,f){this.log("Server response: "+d);if("json"==this._opts.responseType.toLowerCase()&&(d=c.parseJSON(d),!1===d)){this._errorFinish(a,b,"parseerror",g,l,e,h,f);return}this._opts.onComplete.call(this,g,d);this._last(l,e,k,h,f)},_uploadXhr:function(a,b,d,g,l,e){var k=this,h=this._opts,f=c.newXHR(),m={},t,r,p,n;if(!1===h.startXHR.call(this,a,b))this._disabled&&this.enable(),this._active--;else{r=this._abortBtn;p=this._removeAbort;this._abortBtn=this._removeAbort=null;m[h.name]=a;c.extendObj(m,
h.data);m=h.url+"?"+c.obj2string(m);d&&(d.innerHTML=b+"K");e&&(e.innerHTML="0%");g&&(g.style.width="0%");h.onProgress.call(this,0);t=function(c,g){var m,n;try{if(t&&(g||4===f.readyState))if(f.onreadystatechange=function(){},t=w,g)4!==f.readyState&&f.abort(),k._last(d,l,e,r,p),h.onAbort.call(k,a);else{m=f.status;try{n=f.statusText}catch(s){n=""}200<=m&&300>m?(h.endXHR.call(k,a,b),k._finish(m,n,f.responseText,a,d,l,e,r,p)):k._errorFinish(m,n,"error",a,d,l,e,r,p)}}catch(q){g||k._errorFinish(-1,q.message,
"error",a,d,l,e,r,p)}};n=function(){c.removeEvent(r,"click",n);t&&t(w,!0)};r&&c.addEvent(r,"click",n);f.onreadystatechange=t;f.open(h.method.toUpperCase(),m,!0);c.addEvent(f.upload,"progress",function(a){a.lengthComputable&&(a=Math.round(100*(a.loaded/a.total)),h.onProgress.call(k,a),e&&(e.innerHTML=a+"%"),g&&(g.style.width=a+"%"))});f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.setRequestHeader("X-File-Name",encodeURIComponent(a));"json"==h.responseType.toLowerCase()&&f.setRequestHeader("Accept",
"application/json, text/javascript, */*; q=0.01");if(!0===h.multipart){var m=new FormData,s;for(s in h.data)h.data.hasOwnProperty(s)&&m.append(s,h.data[s]);m.append(h.name,this._file);this.log("Commencing upload using multipart form");f.send(m)}else f.setRequestHeader("Content-Type","application/octet-stream"),this.log("Commencing upload using binary stream"),f.send(this._file);this.removeCurrent()}},_uploadIframe:function(a,b,d,g,l){var e=this,k=this._opts,h=this._progKey,f=this._getFrame(),m=this._getForm(f),
t,r;if(!1===k.startNonXHR.call(this,a))this._disabled&&this.enable(),this._active--;else{this._opts.nginxProgressUrl&&(m.action=this._opts.url+"?"+this._opts.nginxProgressHeader+"="+h);!1!==k.progressUrl&&(r=this._getHidden(k.keyParamName,h),m.appendChild(r),r=null);for(var p in k.data)k.data.hasOwnProperty(p)&&(r=this._getHidden(p,k.data[p]),m.appendChild(r));m.appendChild(this._file);k.onProgress.call(this,0);l&&(l.innerHTML="0%");d&&(d.style.width="0%");t=c.addEvent(f,"load",function(){try{var d=
(f.contentDocument?f.contentDocument:f.contentWindow.document).body.innerHTML;c.removeItem(e._progKeys,h);k.endNonXHR.call(e,a);e._finish("","",d,a,b,g,l)}catch(m){e._errorFinish("",m.message,"error",a,b,g,l)}e._sizeFlags[h]&&delete e._sizeFlags.key;t();c.remove(f);k=h=f=b=g=l=null});e.log("Commencing upload using iframe");m.submit();c.remove(m);m=r=null;if(this._opts.progressUrl||this._opts.nginxProgressUrl)this._progKeys.push(h),n.setTimeout(function(){e._getProg(h,d,b,l,1);d=b=l=null},e._opts.checkProgressInterval),
this._progKey=c.getUID();this.removeCurrent()}},_getProg:function(a,b,d,g,l){var e=this,k=c.newXHR(),h=(new Date).getTime(),f,m;a&&(this._opts.nginxProgressUrl?f=e._opts.nginxProgressUrl+"?_="+h:this._opts.progressUrl&&(f=e._opts.progressUrl+"?progresskey="+encodeURIComponent(a)+"&_="+h),m=function(){var f,h,p,q,s;try{if(m&&4===k.readyState){k.onreadystatechange=function(){};m=w;q=k.status;try{s=k.statusText}catch(u){s=""}if(200<=q&&300>q){f=c.parseJSON(k.responseText);l++;if(!1===f){e.log("Error parsing progress response (expecting JSON)");
return}if(e._opts.nginxProgressUrl)if("uploading"==f.state)h=f.size,0<h&&(p=Math.round(100*(f.received/h)),h=Math.round(h/1024));else if("done"==f.state)p=100;else{if("error"==f.state){e.log("Error requesting upload progress: "+f.status);return}}else e._opts.progressUrl&&!0===f.success&&(h=f.size,p=f.pct);p&&(g&&(g.innerHTML=p+"%"),b&&(b.style.width=p+"%"),e._opts.onProgress.call(e,p));h&&!e._sizeFlags[a]&&(e._sizeFlags[a]=1,d&&(d.innerHTML=h+"K"),e._opts.onUpdateFileSize.call(e,h));if(!p&&!h&&l>=
e._maxFails){e.log("Failed progress request limit reached");return}100>p&&c.contains(e._progKeys,a)&&n.setTimeout(function(){e._getProg(a,b,d,g,l);a=b=d=g=l=null},e._opts.checkProgressInterval)}else c.removeItem(e._progKeys,a),e.log("Error requesting upload progress: "+q+" "+s);k=h=p=q=s=f=null}}catch(v){e.log("Error requesting upload progress: "+v.message)}},k.onreadystatechange=m,k.open("GET",f,!0),e._opts.nginxProgressUrl&&k.setRequestHeader(e._opts.nginxProgressHeader,a),k.setRequestHeader("X-Requested-With",
"XMLHttpRequest"),k.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),k.send())},_checkFile:function(a,b,c){var g=this._opts.allowedExtensions,l=g.length,e=!1;if(0<l){for(b=b.toLowerCase();l--;)if(g[l].toLowerCase()==b){e=!0;break}if(!e)return this.removeCurrent(),this.log("File extension not permitted"),this._opts.onExtError.call(this,a,b),!1}return c&&!1!==this._opts.maxSize&&c>this._opts.maxSize?(this.removeCurrent(),this.log(a+" exceeds "+this._opts.maxSize+"K limit"),
this._opts.onSizeError.call(this,a,c),!1):!0},submit:function(){var a,b,d;this._disabled||this._active>=this._opts.maxUploads||1>this._queue.length||(this._file=this._queue[0],u?(a=c.getFilename(this._file.name),d=Math.round(this._file.size/1024)):a=c.getFilename(this._file.value),b=c.getExt(a),this._checkFile(a,b,d)&&!1!==this._opts.onSubmit.call(this,a,b)&&(this._active++,(!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable(),u?this._uploadXhr(a,d,
this._sizeBox,this._progBar,this._progBox,this._pctBox):this._uploadIframe(a,this._sizeBox,this._progBar,this._progBox,this._pctBox),this._sizeBox=this._progBar=this._progBox=this._pctBox=null))}};n.ss=c})(window,document);