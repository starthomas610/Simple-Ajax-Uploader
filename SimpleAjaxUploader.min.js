/**  Simple Ajax Uploader v1.8.2 Copyright 2012-2013 LPology, LLC  MIT license https://github.com/LPology/Simple-Ajax-Uploader */ 
(function(r,m,u){var d=r.ss||{},x=/^\s+/,y=/\s+$/,z=/[xy]/g,A=/.*(\/|\\)/,B=/.*[.]/,C=/[\t\r\n]/g,D=0<Object.prototype.toString.call(r.HTMLElement).indexOf("Constructor"),w=m.createElement("input"),t;w.type="file";t="multiple"in w&&"undefined"!==typeof File&&"undefined"!==typeof(new XMLHttpRequest).upload;d.obj2string=function(a,b){var c=[],e;for(e in a)if(a.hasOwnProperty(e)){var g=b?b+"["+e+"]":e,f=a[e];c.push("object"===typeof f?d.obj2string(f,g):encodeURIComponent(g)+"="+encodeURIComponent(f))}return c.join("&")};
d.extendObj=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};d.contains=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};d.removeItem=function(a,b){for(var c=a.length;c--;)if(a[c]===b){a.splice(c,1);break}};d.addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c);return function(){d.removeEvent(a,b,c)}};d.removeEvent=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)};d.newXHR=function(){if("undefined"!==
typeof XMLHttpRequest)return new r.XMLHttpRequest;if(r.ActiveXObject)try{return new r.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return!1}};d.parseJSON=function(a){if(!a)return!1;a=d.trim(a);if(r.JSON&&r.JSON.parse)try{return r.JSON.parse(a)}catch(b){return!1}return a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?(new Function("return "+a))():!1};d.getBox=
function(a){var b,c=0;b=0;if(a.getBoundingClientRect)a=a.getBoundingClientRect(),b=m.documentElement,c=a.top+(r.pageYOffset||b.scrollTop)-(b.clientTop||0),b=a.left+(r.pageXOffset||b.scrollLeft)-(b.clientLeft||0);else{do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent)}return{top:Math.round(c),left:Math.round(b)}};d.addStyles=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])};d.copyLayout=function(a,b){var c=d.getBox(a);d.addStyles(b,{position:"absolute",left:c.left+"px",top:c.top+
"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})};d.toElement=function(){var a=m.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();d.getUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(z,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};d.trim=function(a){return a.toString().replace(x,"").replace(y,"")};d.getFilename=function(a){return a.replace(A,"")};d.getExt=function(a){return-1!==a.indexOf(".")?
a.replace(B,""):""};d.hasClass=function(a,b){return 0<=(" "+a.className+" ").replace(C," ").indexOf(" "+b+" ")};d.addClass=function(a,b){if(!b||""===b)return!1;d.hasClass(a,b)||(a.className+=" "+b)};d.removeClass=function(){var a={};return function(b,c){a[c]||(a[c]=RegExp("(?:^|\\s)"+c+"(?!\\S)"));b.className=b.className.replace(a[c],"")}}();d.purge=function(a){var b=a.attributes,c,e;if(b)for(c=b.length-1;0<=c;c-=1)e=b[c].name,"function"===typeof a[e]&&(a[e]=null);if(b=a.childNodes)for(b=b.length,
c=0;c<b;c+=1)d.purge(a.childNodes[c])};d.remove=function(a){a.parentNode&&(d.purge(a),a.parentNode.removeChild(a))};d.verifyElem=function(a){"undefined"!==typeof jQuery&&a instanceof jQuery?a=a[0]:"string"===typeof a&&("#"==a.charAt(0)&&(a=a.substr(1)),a=m.getElementById(a));if(!a||1!==a.nodeType)return!1;"A"==a.nodeName.toUpperCase()&&(a.style.cursor="pointer",d.addEvent(a,"click",function(a){a&&a.preventDefault?a.preventDefault():r.event&&(r.event.returnValue=!1)}));return a};d.SimpleUpload=function(a){var b,
c;this._opts={button:"",url:"",progressUrl:!1,nginxProgressUrl:!1,multiple:!1,maxUploads:3,queue:!0,checkProgressInterval:50,keyParamName:"APC_UPLOAD_PROGRESS",nginxProgressHeader:"X-Progress-ID",allowedExtensions:[],accept:"",maxSize:!1,name:"",data:{},autoSubmit:!0,multipart:!1,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",onAbort:function(a,b){},onChange:function(a,b,c){},onSubmit:function(a,b,c){},onProgress:function(a){},onUpdateFileSize:function(a){},onComplete:function(a,
b,c){},onExtError:function(a,b){},onSizeError:function(a,b){},onError:function(a,b,c,d,s){},startXHR:function(a,b,c){},endXHR:function(a,b,c){},startNonXHR:function(a,b){},endNonXHR:function(a,b){}};d.extendObj(this._opts,a);a=null;this._btns=[];if(this._opts.button instanceof Array)for(b=this._opts.button.length,a=0;a<b;a++)c=d.verifyElem(this._opts.button[a]),!1!==c?this._btns.push(this.rerouteClicks(c)):this.log("Button with array index "+a+" is invalid");else c=d.verifyElem(this._opts.button),
!1!==c&&this._btns.push(this.rerouteClicks(c));delete this._opts.button;if(1>this._btns.length||!1===this._btns[0])throw Error("Invalid button. Make sure the element you're passing exists.");!1===this._opts.multiple&&(this._opts.maxUploads=1);this._queue=[];this._active=0;this._disabled=!1;this._progKeys=[];this._maxFails=10;t||(this._progKey=d.getUID(),this._sizeFlags={});this._createInput();this.enable()};d.SimpleUpload.prototype={destroy:function(){for(var a=this._btns.length;a--;)this._btns[a].off&&
this._btns[a].off(),d.removeClass(this._btns[a],this._opts.hoverClass),d.removeClass(this._btns[a],this._opts.focusClass),d.removeClass(this._btns[a],this._opts.disabledClass),this._btns[a].disabled=!1;d.remove(this._input.parentNode);for(var b in this)this.hasOwnProperty(b)&&delete this.prop},log:function(a){this._opts.debug&&r.console&&console.log("[uploader] "+a)},setData:function(a){this._opts.data=a},setProgressBar:function(a){this._progBar=d.verifyElem(a)},setPctBox:function(a){this._pctBox=
d.verifyElem(a)},setFileSizeBox:function(a){this._sizeBox=d.verifyElem(a)},setProgressContainer:function(a){this._progBox=d.verifyElem(a)},setAbortBtn:function(a,b){this._abortBtn=d.verifyElem(a);this._removeAbort=!1;b&&(this._removeAbort=!0)},getQueueSize:function(){return this._queue.length},_cycleQueue:function(){0<this._queue.length&&this._opts.autoSubmit&&this.submit()},removeCurrent:function(){for(var a=this._queue.length;a--;)if(this._queue[a].file===this._file){this._queue.splice(a,1);break}delete this._file;
this._cycleQueue()},disable:function(){var a=this._btns.length,b;for(this._disabled=!0;a--;)if(b=this._btns[a].nodeName.toUpperCase(),d.addClass(this._btns[a],this._opts.disabledClass),"INPUT"==b||"BUTTON"==b)this._btns[a].disabled=!0;this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){var a=this._btns.length;for(this._disabled=!1;a--;)d.removeClass(this._btns[a],this._opts.disabledClass),this._btns[a].disabled=!1},_createInput:function(){var a=
this,b=m.createElement("div");this._input=m.createElement("input");this._input.type="file";this._input.name=this._opts.name;t&&!D&&(this._input.multiple=!0);"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept);d.addStyles(b,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});d.addStyles(this._input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});
"0"!==b.style.opacity&&(b.style.filter="alpha(opacity=0)");d.addEvent(this._input,"change",function(){var b=a._overBtn,e,g;if(a._input&&""!==a._input.value){if(t){e=d.getFilename(a._input.files[0].name);g=d.getExt(e);if(!1===a._opts.onChange.call(a,e,g,b))return;e=a._input.files.length;a._opts.multiple||(e=1);for(g=0;g<e;g++)a._queue.push({file:a._input.files[g],btn:b})}else{e=d.getFilename(a._input.value);g=d.getExt(e);if(!1===a._opts.onChange.call(a,e,g,b))return;a._queue.push({file:a._input,btn:b})}d.removeClass(a._overBtn,
a._opts.hoverClass);d.removeClass(a._overBtn,a._opts.focusClass);d.remove(a._input.parentNode);delete a._input;a._createInput();a._opts.autoSubmit&&a.submit()}});d.addEvent(this._input,"mouseover",function(){d.addClass(a._overBtn,a._opts.hoverClass)});d.addEvent(this._input,"mouseout",function(){d.removeClass(a._overBtn,a._opts.hoverClass);d.removeClass(a._overBtn,a._opts.focusClass);a._input.parentNode.style.visibility="hidden"});d.addEvent(this._input,"focus",function(){d.addClass(a._overBtn,a._opts.focusClass)});
d.addEvent(this._input,"blur",function(){d.removeClass(a._overBtn,a._opts.focusClass)});m.body.appendChild(b);b.appendChild(this._input)},rerouteClicks:function(a){var b=this;a.off=d.addEvent(a,"mouseover",function(){b._disabled||(b._input||b._createInput(),b._overBtn=a,d.copyLayout(a,b._input.parentNode),b._input.parentNode.style.visibility="visible")});return a},_getFrame:function(){var a=d.getUID(),b=d.toElement('<iframe src="javascript:false;" name="'+a+'" />');m.body.appendChild(b);b.style.display=
"none";b.id=a;return b},_getForm:function(a){var b=d.toElement('<form method="post" enctype="multipart/form-data"></form>');m.body.appendChild(b);b.style.display="none";b.action=this._opts.url;b.target=a.name;return b},_getHidden:function(a,b){var c=m.createElement("input");c.type="hidden";c.name=a;c.value=b;return c},_last:function(a,b,c,e,g){a&&(a.innerHTML="");b&&d.remove(b);c&&(c.innerHTML="");e&&g&&d.remove(e);this._active--;this._disabled&&this.enable();this._cycleQueue()},_errorFinish:function(a,
b,c,d,g,f,k,s,p,q){this.log("Upload failed: "+a+" "+b);this._opts.onError.call(this,d,c,a,b,q);this._last(g,f,k,s,p)},_finish:function(a,b,c,e,g,f,k,s,p,q){this.log("Server response: "+c);if("json"==this._opts.responseType.toLowerCase()&&(c=d.parseJSON(c),!1===c)){this._errorFinish(a,b,"parseerror",e,g,f,s,p,q);return}this._opts.onComplete.call(this,e,c,q);this._last(g,f,k,s,p)},_uploadXhr:function(a,b,c,e,g,f,k,s,p){var q=this,h=this._opts,n=d.newXHR(),l={},r,m;l[h.name]=a;d.extendObj(l,h.data);
l=h.url+"?"+d.obj2string(l);c&&(c.innerHTML=b+"K");f&&(f.innerHTML="0%");e&&(e.style.width="0%");h.onProgress.call(this,0);r=function(d,e){var l,m;try{if(r&&(e||4===n.readyState))if(n.onreadystatechange=function(){},r=u,e)4!==n.readyState&&n.abort(),q._last(c,g,f,k,s),h.onAbort.call(q,a,p);else{l=n.status;try{m=n.statusText}catch(v){m=""}200<=l&&300>l?(h.endXHR.call(q,a,b,p),q._finish(l,m,n.responseText,a,c,g,f,k,s,p)):q._errorFinish(l,m,"error",a,c,g,f,k,s,p)}}catch(t){e||q._errorFinish(-1,t.message,
"error",a,c,g,f,k,s,p)}};m=function(){d.removeEvent(k,"click",m);r&&r(u,!0)};k&&d.addEvent(k,"click",m);n.onreadystatechange=r;n.open(h.method.toUpperCase(),l,!0);d.addEvent(n.upload,"progress",function(a){a.lengthComputable&&(a=Math.round(a.loaded/a.total*100),h.onProgress.call(q,a),f&&(f.innerHTML=a+"%"),e&&(e.style.width=a+"%"))});n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.setRequestHeader("X-File-Name",encodeURIComponent(a));"json"==h.responseType.toLowerCase()&&n.setRequestHeader("Accept",
"application/json, text/javascript, */*; q=0.01");if(!0===h.multipart){var l=new FormData,v;for(v in h.data)h.data.hasOwnProperty(v)&&l.append(v,h.data[v]);l.append(h.name,this._file);this.log("Commencing upload using multipart form");n.send(l)}else n.setRequestHeader("Content-Type","application/octet-stream"),this.log("Commencing upload using binary stream"),n.send(this._file);this.removeCurrent()},_uploadIframe:function(a,b,c,e,g,f){var k=this,s=this._opts,p=this._progKey,q=this._getFrame(),h=this._getForm(q),
n,l;this._opts.nginxProgressUrl&&(h.action=this._opts.url+"?"+this._opts.nginxProgressHeader+"="+p);!1!==s.progressUrl&&(l=this._getHidden(s.keyParamName,p),h.appendChild(l),l=null);for(var m in s.data)s.data.hasOwnProperty(m)&&(l=this._getHidden(m,s.data[m]),h.appendChild(l));h.appendChild(this._file);s.onProgress.call(this,0);g&&(g.innerHTML="0%");c&&(c.style.width="0%");n=d.addEvent(q,"load",function(){try{var c=(q.contentDocument?q.contentDocument:q.contentWindow.document).body.innerHTML;d.removeItem(k._progKeys,
p);s.endNonXHR.call(k,a,f);k._finish("","",c,a,b,e,g,u,u,f)}catch(h){k._errorFinish("",h.message,"error",a,b,e,g,u,u,f)}k._sizeFlags&&k._sizeFlags[p]&&delete k._sizeFlags.key;n();d.remove(q);s=p=q=b=e=g=f=null});k.log("Commencing upload using iframe");h.submit();d.remove(h);h=l=null;if(this._opts.progressUrl||this._opts.nginxProgressUrl)this._progKeys.push(p),r.setTimeout(function(){k._getProg(p,c,b,g,1);c=b=g=null},k._opts.checkProgressInterval),this._progKey=d.getUID();this.removeCurrent()},_getProg:function(a,
b,c,e,g){var f=this,k=d.newXHR(),m=(new Date).getTime(),p,q;a&&(this._opts.nginxProgressUrl?p=f._opts.nginxProgressUrl+"?_="+m:this._opts.progressUrl&&(p=f._opts.progressUrl+"?progresskey="+encodeURIComponent(a)+"&_="+m),q=function(){var h,n,l,m,p;try{if(q&&4===k.readyState){k.onreadystatechange=function(){};q=u;m=k.status;try{p=k.statusText}catch(s){p=""}if(200<=m&&300>m){h=d.parseJSON(k.responseText);g++;if(!1===h){f.log("Error parsing progress response (expecting JSON)");return}if(f._opts.nginxProgressUrl)if("uploading"==
h.state)n=h.size,0<n&&(l=Math.round(h.received/n*100),n=Math.round(n/1024));else if("done"==h.state)l=100;else{if("error"==h.state){f.log("Error requesting upload progress: "+h.status);return}}else f._opts.progressUrl&&!0===h.success&&(n=h.size,l=h.pct);l&&(e&&(e.innerHTML=l+"%"),b&&(b.style.width=l+"%"),f._opts.onProgress.call(f,l));n&&!f._sizeFlags[a]&&(f._sizeFlags[a]=1,c&&(c.innerHTML=n+"K"),f._opts.onUpdateFileSize.call(f,n));if(!l&&!n&&g>=f._maxFails){f.log("Failed progress request limit reached");
return}100>l&&d.contains(f._progKeys,a)&&r.setTimeout(function(){f._getProg(a,b,c,e,g);a=b=c=e=g=null},f._opts.checkProgressInterval)}else d.removeItem(f._progKeys,a),f.log("Error requesting upload progress: "+m+" "+p);k=n=l=m=p=h=null}}catch(t){f.log("Error requesting upload progress: "+t.message)}},k.onreadystatechange=q,k.open("GET",p,!0),f._opts.nginxProgressUrl&&k.setRequestHeader(f._opts.nginxProgressHeader,a),k.setRequestHeader("X-Requested-With","XMLHttpRequest"),k.setRequestHeader("Accept",
"application/json, text/javascript, */*; q=0.01"),k.send())},_checkFile:function(a,b,c){var d=this._opts.allowedExtensions,g=d.length,f=!1;if(0<g){for(b=b.toLowerCase();g--;)if(d[g].toLowerCase()==b){f=!0;break}if(!f)return this.removeCurrent(),this.log("File extension not permitted"),this._opts.onExtError.call(this,a,b),!1}return c&&!1!==this._opts.maxSize&&c>this._opts.maxSize?(this.removeCurrent(),this.log(a+" exceeds "+this._opts.maxSize+"K limit"),this._opts.onSizeError.call(this,a,c),!1):!0},
submit:function(){var a,b,c,e;if(!(this._disabled||this._active>=this._opts.maxUploads||1>this._queue.length)&&(this._file=this._queue[0].file,b=this._queue[0].btn,t?(a=d.getFilename(this._file.name),e=Math.round(this._file.size/1024)):a=d.getFilename(this._file.value),c=d.getExt(a),this._checkFile(a,c,e)&&!1!==this._opts.onSubmit.call(this,a,c,b))){this._active++;(!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable();if(t){if(!1===this._opts.startXHR.call(this,
a,e,b)){this._disabled&&this.enable();this._active--;return}this._uploadXhr(a,e,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._abortBtn,this._removeAbort,b)}else{if(!1===this._opts.startNonXHR.call(this,a,b)){this._disabled&&this.enable();this._active--;return}this._uploadIframe(a,this._sizeBox,this._progBar,this._progBox,this._pctBox,b)}this._sizeBox=this._progBar=this._progBox=this._pctBox=this._abortBtn=this._removeAbort=null}}};r.ss=d})(window,document);