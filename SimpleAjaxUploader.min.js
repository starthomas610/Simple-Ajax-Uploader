/** Simple Ajax Uploader v1.5.1 Copyright 2012-2013 LPology, LLC  MIT license https://github.com/LPology/Simple-Ajax-Uploader */ 
var ss=ss||{};ss.obj2string=function(a,b){var c=[],e;if("object"!==typeof a)return"";for(e in a)if(a.hasOwnProperty(e)){var d=b?b+"["+e+"]":e,g=a[e];c.push("object"===typeof g?ss.obj2string(g,d):encodeURIComponent(d)+"="+encodeURIComponent(g))}return c.join("&")};ss.extendObj=function(a,b){var c;if("object"!==typeof a||"object"!==typeof b)return!1;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};ss.contains=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};
ss.removeItem=function(a,b){for(var c in a)if(a[c]==b){a.splice(c,1);break}};ss.addEvent=function(a,b,c){"string"===typeof a&&(a=document.getElementById(a));a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)};ss.removeEvent=function(a,b,c){"string"===typeof a&&(a=document.getElementById(a));a.attachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)};ss.newXHR=function(){if(void 0!==typeof XMLHttpRequest)return new window.XMLHttpRequest;if(window.ActiveXObject)try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){return!1}};
ss.parseJSON=function(a){if(!a||"string"!==typeof a)return!1;a=ss.trim(a);if(window.JSON&&window.JSON.parse)try{return window.JSON.parse(a)}catch(b){return!1}return a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?(new Function("return "+a))():!1};
ss.getOffsetSum=function(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop,10),c+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{top:b,left:c}};ss.getOffsetRect=function(a){a=a.getBoundingClientRect();var b=document.body,c=document.documentElement,e=a.left+(window.pageXOffset||c.scrollLeft||b.scrollLeft)-(c.clientLeft||b.clientLeft||0);return{top:Math.round(a.top+(window.pageYOffset||c.scrollTop||b.scrollTop)-(c.clientTop||b.clientTop||0)),left:Math.round(e)}};
ss.getOffset=function(a){return a.getBoundingClientRect?ss.getOffsetRect(a):ss.getOffsetSum(a)};ss.getBox=function(a){var b,c;c=ss.getOffset(a);b=c.left;c=c.top;return{left:b,right:b+a.offsetWidth,top:c,bottom:c+a.offsetHeight}};ss.addStyles=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])};ss.copyLayout=function(a,b){var c=ss.getBox(a);ss.addStyles(b,{position:"absolute",left:c.left+"px",top:c.top+"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})};
ss.toElement=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();ss.getUID=function(){var a=0;return function(){return a++}}();ss.trim=function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,"")};ss.getFilename=function(a){return a.replace(/.*(\/|\\)/,"")};ss.getExt=function(a){return-1!==a.indexOf(".")?a.replace(/.*[.]/,""):""};ss.hasClass=function(a,b){return RegExp("(^| )"+b+"( |$)").test(a.className)};
ss.addClass=function(a,b){if(!b||""===b)return!1;ss.hasClass(a,b)||(a.className+=" "+b)};ss.removeClass=function(a,b){a.className=a.className.replace(RegExp("(^| )"+b+"( |$)")," ").replace(/^\s+|\s+$/g,"")};ss.remove=function(a){a.parentNode&&a.parentNode.removeChild(a)};
ss.verifyElem=function(a){"undefined"!==typeof jQuery&&a instanceof jQuery?a=a[0]:"string"===typeof a&&(/^#.*/.test(a)&&(a=a.slice(1)),a=document.getElementById(a));if(!a||1!==a.nodeType)return!1;"A"==a.nodeName.toUpperCase()&&ss.addEvent(a,"click",function(a){a&&a.preventDefault?a.preventDefault():window.event&&(window.event.returnValue=!1)});return a};
ss.SimpleUpload=function(a){this._settings={button:"",url:"",progressUrl:!1,multiple:!1,maxUploads:3,checkProgressInterval:50,keyParamName:"APC_UPLOAD_PROGRESS",allowedExtensions:[],maxSize:!1,name:"",data:{},autoSubmit:!0,multipart:!1,responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",messages:{extError:"{name} is not a valid file type.\n\nOnly {ext} files are permitted.",sizeError:"{name} is larger than the {size} size limit."},onChange:function(){},onSubmit:function(){},onProgress:function(){},
onUpdateFileSize:function(){},onComplete:function(){},onError:function(){},startXHR:function(){},endXHR:function(){},startNonXHR:function(){},endNonXHR:function(){}};ss.extendObj(this._settings,a);this._button=ss.verifyElem(this._settings.button);if(!1===this._button)throw Error("Invalid button. Make sure the element you're passing exists.");this._file=this._size=this._ext=this._filename=this._input=null;this._queue=[];this._fileSizeBox=this._progressContainer=this._progressBar=null;this._activeUploads=
0;this._doProgressUpdates=this._disabled=!1;this._activeProgressKeys=[];this._uploadProgressKey=null;this._maxUpdateFails=10;this._isXhrUploadSupported()?(this._XhrIsSupported=!0,this.log("XHR upload supported")):(this._XhrIsSupported=!1,this.log("XHR upload not supported, using iFrame method"),this._settings.progressUrl&&this._getUploadProgressKey());this._createInput();this.enable();this._rerouteClicks()};
ss.SimpleUpload.prototype={log:function(a){this._settings.debug&&window.console&&console.log("[uploader] "+a)},setData:function(a){this._settings.data="object"===typeof a?a:{}},setProgressBar:function(a){this._progressBar=ss.verifyElem(a)},setFileSizeBox:function(a){this._fileSizeBox=ss.verifyElem(a)},setProgressContainer:function(a){this._progressContainer=ss.verifyElem(a)},getQueueSize:function(){return this._queue.length},removeCurrent:function(){this._queue.splice(0,1);this._cycleQueue()},disable:function(){var a=
this._button.nodeName.toUpperCase();ss.addClass(this._button,this._settings.disabledClass);this._disabled=!0;("INPUT"==a||"BUTTON"==a)&&this._button.setAttribute("disabled","disabled");this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(){ss.removeClass(this._button,this._settings.disabledClass);this._button.removeAttribute("disabled");this._disabled=!1},_isXhrUploadSupported:function(){var a=document.createElement("input");a.type="file";return"multiple"in
a&&"undefined"!=typeof File&&"undefined"!=typeof(new XMLHttpRequest).upload},_createInput:function(){var a=this,b=document.createElement("div"),c=document.createElement("input");c.setAttribute("type","file");c.setAttribute("name",a._settings.name);this._XhrIsSupported&&this._settings.multiple&&c.setAttribute("multiple",!0);ss.addStyles(b,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});ss.addStyles(c,{position:"absolute",right:0,
margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});if("0"!==b.style.opacity){if("undefined"==typeof b.filters)throw Error("Opacity not supported by the browser");b.style.filter="alpha(opacity=0)"}ss.addEvent(c,"change",function(){var b,d,g;if(c&&""!==c.value){if(!a._settings.multiple||!a._XhrIsSupported){b=ss.getFilename(c.value);d=ss.getExt(b);if(!1===a._settings.onChange.call(a,b,d))return;a._queue.push(c)}else{g=c.files.length;b=null!==c.files[0].fileName&&void 0!==
c.files[0].fileName?c.files[0].fileName:c.files[0].name;b=ss.getFilename(b);d=ss.getExt(b);if(!1===a._settings.onChange.call(a,b,d))return;for(b=0;b<g;b++)a._queue.push(c.files[b])}a._clearInput();a._settings.autoSubmit&&a.submit()}});ss.addEvent(c,"mouseover",function(){ss.addClass(a._button,a._settings.hoverClass)});ss.addEvent(c,"mouseout",function(){var b=a._button,d=a._settings.focusClass;ss.removeClass(b,a._settings.hoverClass);ss.removeClass(b,d);c.parentNode&&(c.parentNode.style.visibility=
"hidden")});ss.addEvent(c,"focus",function(){ss.addClass(a._button,a._settings.focusClass)});ss.addEvent(c,"blur",function(){ss.removeClass(a._button,a._settings.focusClass)});document.body.appendChild(b);b.appendChild(c);a._input=c},_clearInput:function(){this._input&&(ss.removeClass(this._button,this._settings.hoverClass),ss.removeClass(this._button,this._settings.focusClass),ss.remove(this._input.parentNode),this._input=null,this._createInput())},_rerouteClicks:function(){var a=this;ss.addEvent(a._button,
"mouseover",function(){if(!a._disabled){a._input||a._createInput();var b=a._input.parentNode;ss.copyLayout(a._button,b);b.style.visibility="visible"}})},_createIframe:function(){var a=ss.getUID(),b=ss.toElement('<iframe src="javascript:false;" name="'+a+'" />');document.body.appendChild(b);b.style.display="none";b.setAttribute("id",a);return b},_createForm:function(a){var b=ss.toElement('<form method="post" enctype="multipart/form-data"></form>');document.body.appendChild(b);b.style.display="none";
b.setAttribute("action",this._settings.url);b.setAttribute("target",a.name);return b},_createHiddenInput:function(a,b){var c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("name",a);c.setAttribute("value",b);return c},_finish:function(a,b,c,e,d){this.log("server response: "+a);this._activeUploads--;"json"==this._settings.responseType.toLowerCase()&&(a=ss.parseJSON(a));!1===a?(this.log("bad server response"),this._settings.onError.call(this,b,"parseerror",a)):this._settings.onComplete.call(this,
b,a);d&&ss.remove(d);this._disabled&&this.enable();this._cycleQueue()},_cycleQueue:function(){this._progressContainer=this._progressBar=this._fileSizeBox=this._ext=this._filename=this._file=this._size=null;0<this._queue.length&&this.submit()},_uploadXhr:function(){var a=this,b=a._settings,c=a._filename,e=Math.round(a._size/1024),d=a._fileSizeBox,g=a._progressBar,j=a._progressContainer,h=ss.newXHR(),f={};!1===b.startXHR.call(a,c,e)?(a._disabled&&a.enable(),this._activeUploads--):(d&&(d.innerHTML=e+
"K"),b.onProgress.call(a,0),g&&(g.style.width="0%"),f[b.name]=c,ss.extendObj(f,b.data),f=b.url+"?"+ss.obj2string(f),ss.addEvent(h.upload,"progress",function(c){c.lengthComputable&&(c=Math.round(100*(c.loaded/c.total)),b.onProgress.call(a,c),g&&(g.style.width=c+"%"))}),ss.addEvent(h.upload,"error",function(){a.log("transfer error during upload");b.endXHR.call(a,c,e);b.onError.call(a,c,"transfer error","none")}),h.onreadystatechange=function(){4===this.readyState&&(200===this.status?(b.endXHR.call(a,
c,e),a._finish(this.responseText,c,g,d,j)):(a.log("Progress key error. Status: "+this.status+" Response: "+this.responseText),b.onError.call(a,c,"server error",this.responseText)))},h.open("POST",f,!0),h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.setRequestHeader("X-File-Name",encodeURIComponent(c)),"json"==b.responseType.toLowerCase()&&h.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),!0===b.multipart?(f=new FormData,f.append(b.name,a._file),a.log("commencing upload using multipart form"),
h.send(f)):(h.setRequestHeader("Content-Type","application/octet-stream"),a.log("commencing upload using binary stream"),h.send(a._file)),a.removeCurrent())},_handleIframeResponse:function(a,b,c,e,d){var g;a.parentNode&&(g=a.contentWindow?a.contentWindow.document:a.contentDocument&&a.contentDocument.document?a.contentDocument.document:a.contentDocument,g.body&&!1===g.body.innerHTML||(g=g.body.innerHTML,ss.remove(a),this._finish(g,b,c,e,d)))},_uploadIframe:function(){var a=this,b=a._settings,c=b.checkProgressInterval,
e=a._uploadProgressKey,d=a._progressBar,g=a._progressContainer,j=a._fileSizeBox,h=a._filename,f=a._createIframe(),k=a._createForm(f),l;a._doProgressUpdates&&(l=a._createHiddenInput(b.keyParamName,e),k.appendChild(l));if(!1===b.startNonXHR.call(a,h))a._disabled&&a.enable(),this._activeUploads--;else{l=b.data;b.onProgress.call(a,0);d&&(d.style.width="0%");for(var m in l)if(l.hasOwnProperty(m)){var n=a._createHiddenInput(m,l[m]);k.appendChild(n)}k.appendChild(a._file);ss.addEvent(f,"load",function(){ss.contains(a._activeProgressKeys,
e)&&ss.removeItem(a._activeProgressKeys,e);ss.removeEvent(f,"load",arguments.callee);b.endNonXHR.call(a,h);a._handleIframeResponse(f,h,d,j,g);e=null});a.log("commencing upload using iframe");k.submit();ss.remove(k);k=null;a._doProgressUpdates&&(a._activeProgressKeys.push(e),window.setTimeout(function(){a.log("requesting first progress update");a._getUploadProgress(e,d,j,1)},c),a._alterProgressKey());a.removeCurrent()}},_getUploadProgress:function(a,b,c,e){if(a){var d=this,g=d._settings,j=ss.newXHR(),
h=(new Date).getTime(),h=g.progressUrl+"?progresskey="+encodeURIComponent(a)+"&_="+h;j.onreadystatechange=function(){var f,h=g.checkProgressInterval;if(4===this.readyState)if(200===this.status){if((f=ss.parseJSON(this.responseText))&&!0===f.success){e++;g.onUpdateFileSize.call(d,f.size);g.onProgress.call(d,f.pct);b&&(b.style.width=f.pct+"%");c&&f.size&&(c.innerHTML=f.size+"K");if(100>f.pct&&ss.contains(d._activeProgressKeys,a)){if(0===f.pct&&0===f.size&&e>=d._maxUpdateFails){d.log("reached limit of failed progress requests");
return}window.setTimeout(function(){d._getUploadProgress(a,b,c,e);e=a=null},h)}h=null}}else d.log("Progress error. Status: "+this.status+" Response: "+this.responseText);f=null};j.open("GET",h,!0);j.setRequestHeader("X-Requested-With","XMLHttpRequest");j.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");j.setRequestHeader("Cache-Control","no-cache");j.send();j=null}},_alterProgressKey:function(){this._uploadProgressKey+=ss.getUID()},_getUploadProgressKey:function(){var a=
this,b=ss.newXHR(),c=(new Date).getTime(),c=a._settings.progressUrl+"?getkey="+c;a._uploadProgressKey=null;b.onreadystatechange=function(){var b;if(4===this.readyState)if(200===this.status){if((b=ss.parseJSON(this.responseText))&&b.key)a._uploadProgressKey=b.key,a.log("upload progress key received. Key: "+b.key)}else a.log("error retrieving progress key. Status: "+this.status+" Server response: "+this.responseText)};b.open("GET",c,!0);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Accept",
"application/json, text/javascript, */*; q=0.01");b.setRequestHeader("Cache-Control","no-cache");b.send();b=null},_errorMsg:function(a){var b=this._settings.messages,c=RegExp("{name}","g"),e,d="";if("ext"==a){var g=this._settings.allowedExtensions,j=g.length,h,f;e=RegExp("{ext}","g");for(f=0;f<j;f++)h=g[f].toUpperCase(),f+2===j?h+=" and ":2<j&&f+2<j&&(h+=", "),d+=h;e=b.extError.replace(e,d)}"size"==a&&(d=this._settings.maxSize+"K",e=RegExp("{size}","g"),e=b.sizeError.replace(e,d));e=e.replace(c,this._filename);
alert(e)},_checkFile:function(){if(!this._file||""===this._file.value)return this.log("no file to upload"),!1;if(0<this._settings.allowedExtensions.length&&!this._checkExtension(this._ext))return this.log("File extension not permitted"),this._errorMsg("ext"),!1;if(null!==this._size&&!1!==this._settings.maxSize&&this._size/1024>this._settings.maxSize)return this.log("file exceeds "+this._settings.maxSize+"K limit"),this._errorMsg("size"),!1;this.log("pre-upload file check is successful");return!0},
_checkExtension:function(a){var b=this._settings.allowedExtensions,c=b.length;for(a=a.toLowerCase();c--;)if(b[c].toLowerCase()==a)return!0;return!1},submit:function(){this._disabled||this._activeUploads>=this._settings.maxUploads||(this._file=this._queue[0],this._XhrIsSupported&&this._settings.multiple?(this._filename=null!==this._queue[0].fileName&&void 0!==this._queue[0].fileName?this._queue[0].fileName:this._queue[0].name,this._filename=ss.getFilename(this._filename)):this._filename=ss.getFilename(this._queue[0].value),
this._ext=ss.getExt(this._filename),this._XhrIsSupported&&(this._size=this._queue[0].size),this._checkFile()?!1!==this._settings.onSubmit.call(this,this._filename,this._ext)&&(this._activeUploads++,!1===this._settings.multiple&&this.disable(),this._XhrIsSupported?this._uploadXhr():(!1!==this._settings.progressUrl&&null!==this._uploadProgressKey?this._doProgressUpdates=!0:(this._doProgressUpdates=!1,this.log("no upload progress - progressUrl not defined or progress key not available")),this._uploadIframe())):
this.removeCurrent())}};